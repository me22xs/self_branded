<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- æ·»åŠ Manropeå­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- æ·»åŠ Cookieå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Cookie&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.js"></script>
    <script src="glitchEffect.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('./assets/background8.webp');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: 'Manrope', sans-serif;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
           
            pointer-events: none;
            z-index: 1;
        }

        #navBar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1002; /* æé«˜z-indexï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨å…¶ä»–å…ƒç´ ä¸Šå±‚ */
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto; /* å°†å†…å®¹æ¨åˆ°å³ä¾§ */
        }

        .timer {
            color: #fff;
            font-size: 18px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.4);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1002; /* æé«˜z-indexï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨å…¶ä»–å…ƒç´ ä¸Šå±‚ */
            position: relative; /* æ·»åŠ ç›¸å¯¹å®šä½ä»¥ä½¿z-indexç”Ÿæ•ˆ */
        }

        .timer i {
            font-size: 16px;
            color: #4CAF50;
        }

        .timer span {
            color: #FFD700; /* ä¿®æ”¹ä¸ºè½¯é»„è‰² */
        }

 

        .next-comment-btn {
            background: #ffff00;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .next-comment-btn:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            color: #fff;
        }

        .next-comment-btn i {
            font-size: 18px;
            color: #333;
        }

        .next-comment-btn:hover i {
            color: #fff;
        }

        .comment-count {
            color: #fff;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.4);
            padding: 4px 12px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .nav-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            display: none;
            /* éšè—æ ‡é¢˜ */
        }

        .interaction-icons {
            display: flex;
            gap: 16px;
            margin-left: auto;
            /* å°†å›¾æ ‡æ¨åˆ°å³è¾¹ */
        }

        .interaction-icons i {
            font-size: 24px;
            color: #fff;
            cursor: pointer;
        }

        #commentBox {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 50%;
            max-width: 800px;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            z-index: 1000;
            backdrop-filter: blur(12px);
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .next-comment-btn.show {
            display: flex;
            /* æ˜¾ç¤ºæ—¶ä½¿ç”¨flexå¸ƒå±€ */
        }

        .comment-count {
            color: #fff;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.4);
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .username {
            color: #fff;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .comment {
            color: #fff;
            font-size: 18px;
            line-height: 1.4;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 8px;
            background: none;
            border: none;
        }

        #inputArea {
            position: fixed;
            bottom: 0;
            right: 20px;
            width: 50%;
            max-width: 800px;
            min-width: 300px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(12px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 12px 12px 0 0;
        }

        #textInput {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 22px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
            outline: none;
        }

        #textInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        #sendButton {
            background: transparent;
            border: none;
            color: #fff;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            padding: 8px 16px;
        }

        #platformTip {
            position: fixed;
            bottom: 250px;
            right: 25%;
            transform: none;
            width: 50%;
            max-width: 180px;
            background: transparent;
            padding: 0;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .platform-tip {
            position: absolute;
            width: 100%;
            background: rgba(0,0,0,0.4);
            color: #ffdada;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 1;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        canvas {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 150px;
            z-index: 2;
            mix-blend-mode: screen;
        }

        @keyframes keyPress {
            0% {
                color: #0095f6;
            }

            100% {
                color: #fff;
            }
        }

        .key-pressed {
            animation: keyPress 0.3s ease;
        }

        #taskInfo {
            position: fixed;
            top: 20px;
            right: calc(2% + 16% + 10px); /* å³è¾¹è· = laborStatså³è¾¹è· + laborStatså®½åº¦ + é—´è· */
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 12px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(12px);
            width: 18%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #FFDADA;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: auto;
            min-width: 200px;
            max-width: 300px;
        }

        #laborStats {
            position: fixed;
            top: 20px;
            right: 2%;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border-radius: 12px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(12px);
            width: 16%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color:#FFDADA;
            min-width: 180px;
            max-width: 250px;
        }

        .task-title {
            color: #CCCCCC;
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .task-item {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .task-item span {
            color: #FFD700; /* ä¿®æ”¹ä¸ºè½¯é»„è‰² */
        }

        .labor-title {
            font-weight: bold;
            color: #CCCCCC;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .labor-title i {
            font-size: 18px;
            color: #F2F2F2;
        }

        .speed-meter {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 8px 0;
            position: relative;
            overflow: hidden;
        }

        .speed-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(to right,#F2F2F2, rgba(255, 255, 255, 0.7));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .speed-value {
            font-size: 24px;
            font-weight: 600;
            color: #F2F2F2;
            margin: 8px 0;
        }

        .speed-value span:first-child {
            color: #FFD700; /* ä¿®æ”¹ä¸ºè½¯é»„è‰² */
        }

        .speed-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            margin-top: 4px;
        }

        .labor-stats {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            color: #ffdada;
        }

        .labor-stats span {
            color: #FFD700; /* ä¿®æ”¹ä¸ºè½¯é»„è‰² */
            font-weight: 600;
        }

        @keyframes float {
            0% {
                transform: translateX(-50%) translateY(0px);
            }

            50% {
                transform: translateX(-50%) translateY(-10px);
            }

            100% {
                transform: translateX(-50%) translateY(0px);
            }
        }

        /* æ·»åŠ åŠ è½½é®ç½©å±‚æ ·å¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .loading-text {
            color: #ffdada;
            font-size: 24px;
            font-weight: 500;
            animation: loadingPulse 1.5s infinite;
        }

        @keyframes loadingPulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .emotion-analysis {
            position: fixed;
            right: 2%;
            top: calc(20px + 200px + 10px);
            background: rgba(0, 0, 0, 0.4);
            color: #ffdada;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            gap: 10px;
            width: calc(9% + 18% + 16% + 10px); /* åŒ¹é…taskInfo + laborStats + é—´è· */
            font-size: 14px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 45px;
            box-sizing: border-box;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            min-width: 380px;
            max-width: 900px;
            z-index: 1001;
        }

        .emotion-analysis.show {
            opacity: 1;
            pointer-events: auto;
        }

        .emotion-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emotion-label {
            color: #ffdada;
            font-size: 14px;
            min-width: 50px;
        }

        .emotion-label span:first-child {
            color: #ffdada;
        }

        .emotion-label span:last-child {
            color: #FFD700; /* ä¿®æ”¹ä¸ºè½¯é»„è‰² */
        }

        /* æ·»åŠ æ ‡é¢˜æ æ ·å¼ */
        .story-title-header {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            z-index: 1004; /* ç¡®ä¿åœ¨æ‰€æœ‰å…ƒç´ ä¸Šæ–¹ */
        }

        .title-text {
            font-family: 'Cookie', cursive;
            font-size: 32px;
            padding: 0px 20px;
            background: #2E3A67;
            border-radius: 10px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFDADA;
        }

        /* æ·»åŠ å±…ä¸­ContinueæŒ‰é’®çš„æ ·å¼ */
        .center-continue-button {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 2000;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
            display: none;
            font-family: 'Manrope', sans-serif;
            transition: all 0.3s ease;
        }

        .center-continue-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.8);
        }
    </style>
</head>

<body>
    <div class="story-title-header">
        <div class="title-text">Scene2: Replying</div>
    </div>
    
    <button id="centerContinueButton" class="center-continue-button">Reflection</button>

    <div id="navBar">
        <div class="nav-right">
            <div class="timer">
                <i class="ri-time-line"></i>
                <span id="timerDisplay">00:00</span>
            </div>
        </div>
    </div>

    <div id="platformTip"></div>

    <div id="commentBox">
        <div class="comment-header">
            <div class="username"></div>
            <button class="next-comment-btn">
                <i class="ri-arrow-right-line"></i>
                Next comment Â· <span id="remainingComments">4</span> left
            </button>
        </div>
        <div class="comment"></div>
    </div>

    <div id="inputArea">
        <input type="text" id="textInput" placeholder="Replying...">
        <button id="sendButton">Send</button>
    </div>

    <div id="taskInfo">
        <div class="task-title">How to Use This Page</div>
        <div class="task-item"></div>
        <div class="task-item"><br>Reply to 5 comments to keep your personal brand active.<br>Press Enter or click Send <span style="color: #FFD700;">once</span> to submit each reply.</div>
        <div class="task-item" style="margin-top: 10px; color: #FFD700; font-style: italic;">* Requires internet connection</div>
    </div>

    <div id="laborStats">
        <div class="labor-title">
            <i class="ri-keyboard-line"></i>  Interaction Metrics
        </div>
        <div class="speed-value">
            <span id="replySpeed">0.0</span>
            <span class="speed-label"> keystrokes/sec</span>
        </div>
        <div class="speed-meter">
            <div class="speed-bar" id="speedBar"></div>
        </div>
        <div class="labor-stats">
            Typing Speed: <span id="averageSpeed">0.0</span>  keystrokes/sec
            <br>
            Total Keystrokes: <span id="totalInputCount">0</span> keystrokes
            <br>
            Avg/Reply: <span id="averageKeyCount">0</span> keystrokes
          
            
        </div>
    </div>

    <!-- æ·»åŠ åŠ è½½é®ç½©å±‚ -->
    <div class="loading-overlay">
        <div class="loading-text">Loading...</div>
    </div>

    <div class="emotion-analysis">
        <div class="emotion-item">
            <div class="emotion-label">
                <span>Positive</span>
                <span id="positivePercentage">0%</span>
            </div>
        </div>
        <div class="emotion-item">
            <div class="emotion-label">
                <span>Neutral</span>
                <span id="neutralPercentage">0%</span>
            </div>
        </div>
        <div class="emotion-item">
            <div class="emotion-label">
                <span>Negative</span>
                <span id="negativePercentage">0%</span>
            </div>
        </div>
    </div>

    <script>
        let floatingGroups = [];
        let currentCommentIndex = 0;
        let nextStopY = 100;
        let totalComments = 5;
        let hasReplied = false;
        let glitchEffect = null;

        // å°†APIå¯†é’¥å®šä¹‰ä¸ºå¸¸é‡
        const OPENAI_API_KEY = "YOUR_API_KEY_HERE"; // âœ… å®‰å…¨åšæ³•
        
        // é”®ç›˜è¾“å…¥ç›¸å…³å˜é‡
        let totalKeyPresses = 0;      // æ€»æ•²å‡»æ¬¡æ•°
        let currentKeyPresses = 0;    // å½“å‰ä¼šè¯æ•²å‡»æ¬¡æ•°
        let messageCount = 0;         // å‘é€æ¶ˆæ¯æ•°
        let speedHistory = [];        // é€Ÿåº¦å†å²è®°å½•
        let typingStartTime = null;   // å½“å‰è¾“å…¥ä¼šè¯å¼€å§‹æ—¶é—´
        let lastTypingTime = null;    // æœ€åä¸€æ¬¡è¾“å…¥æ—¶é—´
        let typingTimeout = null;     // é‡ç½®è®¡æ—¶å™¨
        const MAX_SPEED = 10;         // æœ€å¤§é€Ÿåº¦ï¼ˆæ¬¡/ç§’ï¼‰
        const TYPING_INTERVAL = 2000; // é‡ç½®é—´éš”ï¼ˆæ¯«ç§’ï¼‰

        const platformTips = [
            "âœ¨ Your interaction rate is increasing",
            "â¤ï¸ Your reply received a like ",
            " You're gaining new followers! "
        ];

        const popularEmojis = [
            'âœ¨', 'ğŸ¤', 'ğŸ€', 'ğŸ«¶', 'ğŸ’—',
            'ğŸŒ¸', 'ğŸ«§', 'ğŸ§¸', 'ğŸ’•', 'ğŸ’ª',
        ];

        class CommentFloater {
            constructor(username, text) {
                this.username = username;
                this.text = text;
                const commentBox = document.getElementById('commentBox');
                const rect = commentBox.getBoundingClientRect();
                this.x = windowWidth / 2;
                this.y = rect.top - 100;
                this.targetY = nextStopY;
                this.speed = random(2, 4);
                this.opacity = 255;
                this.arrived = false;
                this.characters = [];
                // ä½¿ç”¨ Array.from æ¥æ­£ç¡®å¤„ç†å¤šå­—èŠ‚å­—ç¬¦ï¼ˆå¦‚Emojiï¼‰
                const textChars = Array.from(text);
                this.totalLength = textChars.length; // æ­£ç¡®çš„æ€»é•¿åº¦

                // åˆ›å»ºç”¨æˆ·åæ¼‚æµ®å­—ç¬¦ (ä¿æŒä¸å˜)
                for (let i = 0; i < username.length; i++) {
                    this.characters.push(new FloatingCharacter(
                        username[i],
                        i,
                        username.length, 
                        this.targetY,
                        false
                    ));
                }

                // åˆ›å»ºè¯„è®ºå†…å®¹ï¼ˆåŒ…æ‹¬Emojiï¼‰çš„æ¼‚æµ®å­—ç¬¦
                let charIndex = 0;
                for (const char of textChars) {
                    this.characters.push(new FloatingCharacter(
                        char,           // å½“å‰å­—ç¬¦æˆ–Emoji
                        charIndex,      // å­—ç¬¦åœ¨å¤„ç†åæ•°ç»„ä¸­çš„ç´¢å¼•
                        this.totalLength, // ä½¿ç”¨æ–°çš„æ€»é•¿åº¦
                        this.targetY + 20,
                        false // isEmoji æ ‡å¿—å¯èƒ½ä¸å†éœ€è¦ï¼Œæˆ–è€…éœ€è¦æ›´æ™ºèƒ½çš„åˆ¤æ–­
                    ));
                    charIndex++;
                }
                
                // ç§»é™¤ä¹‹å‰æ·»åŠ éšæœº popularEmojis çš„ä»£ç 
                // this.emoji = getRandomEmoji(); 
                // this.characters.push(new FloatingCharacter(...
            }

            move() {
                if (!this.arrived) {
                    if (this.y > this.targetY) {
                        this.y -= this.speed;
                    } else {
                        this.arrived = true;
                        this.y = this.targetY;
                    }
                }
                // ç§»åŠ¨æ‰€æœ‰å­—ç¬¦
                for (let char of this.characters) {
                    char.move();
                }
            }

            display() {
                // æ˜¾ç¤ºæ‰€æœ‰å­—ç¬¦
                for (let char of this.characters) {
                    char.display();
                }
            }

            isComplete() {
                return this.arrived && this.characters.every(char => char.arrived);
            }
        }

        let floatingComments = [];
        let currentComment = { username: "@mochi.gif", text: "This energy is everything ğŸ’—" };
        const comments = [
            {
                username: "@mochi.gif",
                text: "This energy is everything ğŸ’—"
            },
            {
                username: "@her.glow.journey",
                text: "Wow this feels so real and raw!! thank you for sharing"
            },
            {
                username: "@_.stella.x_",
                text: "Omg. You make that yoga pose loook SO easy ğŸ˜¢ haha body goals"
            },
            {
                username: "@softlyunhinged",
                text: "pls make more like this I'm OBSESSED"
            },
            {
                username: "@yanis_dude7",
                text: "Jwww how tall are you?"
            }
        ];

        // æ·»åŠ æƒ…ç»ªåˆ†æç›¸å…³å˜é‡
        let emotionStats = {
            positive: 0,
            neutral: 0,
            negative: 0,
            total: 0
        };
        
        let emotionHistory = [];
        
        // åˆå§‹åŒ–æ—¶æ¸…é™¤ä¹‹å‰çš„æ•°æ®
        function initEmotionStats() {
            // æ¸…é™¤ localStorage ä¸­çš„æ•°æ®
            localStorage.removeItem('emotionStats');
            localStorage.removeItem('emotionHistory');
            
            // é‡ç½®ç»Ÿè®¡å˜é‡
            emotionStats = {
                positive: 0,
                neutral: 0,
                negative: 0,
                total: 0
            };
            emotionHistory = [];
        }
        
        // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        initEmotionStats();
        
        // æ·»åŠ æƒ…ç»ªåˆ†æå‡½æ•°
        async function analyzeEmotion(text) {
            try {
                console.log('Analyzing text:', text);
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{
                            role: "system",
                            content: 'Analyze the emotional tone of the following reply and return only one of these three labels: "positive", "neutral", or "negative". Do not return any other text.'
                        }, {
                            role: "user",
                            content: text
                        }],
                        temperature: 0.3
                    })
                });

                const data = await response.json();
                console.log('API Response:', data);
                const emotion = data.choices[0].message.content.trim().toLowerCase();
                console.log('Analyzed emotion:', emotion);
                return emotion;
            } catch (error) {
                console.error('Error analyzing emotion:', error);
                return 'neutral';
            }
        }

        // æ›´æ–°æƒ…ç»ªç»Ÿè®¡
        function updateEmotionStats(emotion) {
            console.log('Updating stats with emotion:', emotion);
            // ç¡®ä¿ emotion æ˜¯æœ‰æ•ˆçš„å€¼
            if (['positive', 'neutral', 'negative'].includes(emotion)) {
                emotionStats[emotion]++;
                emotionStats.total++;
                emotionHistory.push(emotion);
                
                // è®¡ç®—ç™¾åˆ†æ¯”
                const positivePercent = ((emotionStats.positive / emotionStats.total) * 100).toFixed(1);
                const neutralPercent = ((emotionStats.neutral / emotionStats.total) * 100).toFixed(1);
                const negativePercent = ((emotionStats.negative / emotionStats.total) * 100).toFixed(1);
                
                console.log('Updated stats:', emotionStats);
                console.log('Percentages:', {positivePercent, neutralPercent, negativePercent});
                
                // å­˜å‚¨ç»Ÿè®¡æ•°æ®
                localStorage.setItem('emotionStats', JSON.stringify(emotionStats));
                localStorage.setItem('emotionHistory', JSON.stringify(emotionHistory));
                
                // æ˜¾ç¤ºæƒ…ç»ªåˆ†æç»“æœ
                showEmotionAnalysis(positivePercent, neutralPercent, negativePercent);
                
                return {
                    positive: positivePercent,
                    neutral: neutralPercent,
                    negative: negativePercent
                };
            }
            console.log('Invalid emotion value:', emotion);
            return {
                positive: '0.0',
                neutral: '0.0',
                negative: '0.0'
            };
        }

        // æ˜¾ç¤ºæƒ…ç»ªåˆ†æç»“æœ
        function showEmotionAnalysis(positive, neutral, negative) {
            const analysisElement = document.querySelector('.emotion-analysis');
            const positiveElement = document.getElementById('positivePercentage');
            const neutralElement = document.getElementById('neutralPercentage');
            const negativeElement = document.getElementById('negativePercentage');
            
            // æ›´æ–°ç™¾åˆ†æ¯”æ˜¾ç¤º
            positiveElement.textContent = `${positive}%`;
            neutralElement.textContent = `${neutral}%`;
            negativeElement.textContent = `${negative}%`;
            
            // æ˜¾ç¤ºåˆ†æç»“æœ
            analysisElement.classList.add('show');
            
            /* 
            // æ˜¾ç¤ºå®¹å™¨å°ºå¯¸
            showContainerSize(analysisElement, 'emotion-analysis');
            */
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                analysisElement.classList.remove('show');
                
                /* 
                // ç§»é™¤å°ºå¯¸æ˜¾ç¤º
                const sizeDisplay = analysisElement.querySelector('.size-display');
                if (sizeDisplay) {
                    sizeDisplay.remove();
                }
                */
            }, 3000);
        }

        function updateLaborStats(speed) {
            // æ›´æ–°é€Ÿåº¦æ¡
            const percentage = Math.min((speed / MAX_SPEED) * 100, 100);
            document.getElementById('speedBar').style.width = `${percentage}%`;

            // æ›´æ–°æ€»è®¡æ•²å‡»æ¬¡æ•°
            document.getElementById('totalInputCount').textContent = totalKeyPresses;

            // æ›´æ–°å¹³å‡æ¯æ¡æ•²å‡»
            document.getElementById('averageKeyCount').textContent =
                messageCount > 0 ? Math.round(totalKeyPresses / messageCount) : 0;

            // æ›´æ–°å¹³å‡é€Ÿåº¦
            if (speed > 0) {
                speedHistory.push(speed);
                const avgSpeed = (speedHistory.reduce((a, b) => a + b, 0) / speedHistory.length).toFixed(1);
                document.getElementById('averageSpeed').textContent = avgSpeed;
            }
        }

        class FloatingCharacter {
            constructor(char, index, totalChars, targetY, isEmoji = false) {
                this.char = char;
                this.isEmoji = isEmoji;
                this.x = windowWidth * 0.3 + (index - totalChars / 2) * 12.5;
                const inputArea = document.getElementById('inputArea');
                const rect = inputArea.getBoundingClientRect();
                this.y = rect.top - 100;
                this.targetY = targetY;
                this.speed = random(2, 4);
                this.opacity = 255;
                this.wiggle = random(0, TWO_PI);
                this.wiggleSpeed = random(0.01, 0.02);
                this.arrived = false;
                
                // æ·»åŠ é¢œè‰²ç›¸å…³å±æ€§
                this.colorPhase = random(0, TWO_PI);  // éšæœºåˆå§‹ç›¸ä½
                this.colorSpeed = random(0.01, 0.03); // éšæœºé¢œè‰²å˜åŒ–é€Ÿåº¦
            }

            move() {
                if (!this.arrived) {
                    if (this.y > this.targetY) {
                        this.y -= this.speed;
                    } else {
                        this.arrived = true;
                        this.y = this.targetY;
                    }
                } else {
                    this.wiggle += this.wiggleSpeed;
                    this.x += sin(this.wiggle) * 0.4;
                    
                    // æ›´æ–°é¢œè‰²ç›¸ä½
                    this.colorPhase += this.colorSpeed;
                }
            }

            getColor() {
                // Instagramé…è‰²æ–¹æ¡ˆ
                const instagramColors = [
                    color(131, 58, 180),  // #833AB4 ç´«è‰²
                    color(225, 48, 108),  // #E1306C ç²‰è‰²
                    color(252, 175, 69)   // #FCAF45 é»„è‰²
                ];
                
                // ä½¿ç”¨æ­£å¼¦å‡½æ•°åœ¨ä¸‰ä¸ªé¢œè‰²ä¹‹é—´å¹³æ»‘è¿‡æ¸¡
                const phase = this.colorPhase % TWO_PI;
                const colorIndex = floor(phase / (TWO_PI / 3));
                const nextColorIndex = (colorIndex + 1) % 3;
                const progress = (phase % (TWO_PI / 3)) / (TWO_PI / 3);
                
                // åœ¨ä¸¤ä¸ªé¢œè‰²ä¹‹é—´æ’å€¼
                const currentColor = instagramColors[colorIndex];
                const nextColor = instagramColors[nextColorIndex];
                
                const r = lerp(red(currentColor), red(nextColor), progress);
                const g = lerp(green(currentColor), green(nextColor), progress);
                const b = lerp(blue(currentColor), blue(nextColor), progress);
                
                return color(r, g, b, this.opacity);
            }

            display() {
                push();
                textAlign(CENTER);
                textSize(16);  // å›ºå®šå¤§å°16
                fill(this.getColor());
                text(this.char, this.x, this.y);
                pop();
            }
        }

        function showPlatformTip(message) {
            const tipElement = document.getElementById('platformTip');
            const newTip = document.createElement('div');
            newTip.className = 'platform-tip';
            newTip.textContent = message || platformTips[Math.floor(Math.random() * platformTips.length)];
            
            // å°†æ‰€æœ‰ç°æœ‰æç¤ºä¸Šç§»
            const existingTips = tipElement.querySelectorAll('.platform-tip');
            existingTips.forEach(tip => {
                const currentBottom = parseInt(tip.style.bottom || '0');
                tip.style.bottom = (currentBottom + 55) + 'px';  // å›ºå®šé—´è·ä¸º 55px (45pxé«˜åº¦ + 10pxé—´è·)
            });
            
            // æ·»åŠ æ–°æç¤º
            newTip.style.bottom = '0px';
            tipElement.appendChild(newTip);
            tipElement.style.opacity = '1';
        }

        function createFloatingText(text) {
            let newGroup = [];
            // ä½¿ç”¨ Array.from æ¥æ­£ç¡®å¤„ç†å¯èƒ½åŒ…å«å¤šå­—èŠ‚å­—ç¬¦çš„è¾“å…¥æ–‡æœ¬
            const textChars = Array.from(text);
            const totalLength = textChars.length; // æ€»é•¿åº¦ç°åœ¨å°±æ˜¯æ–‡æœ¬æœ¬èº«çš„é•¿åº¦

            let charIndex = 0;
            for (const char of textChars) {
                newGroup.push(new FloatingCharacter(
                    char, 
                    charIndex, 
                    totalLength, 
                    nextStopY // ä½¿ç”¨ç›¸åŒçš„nextStopY
                )); 
                charIndex++;
            }
            
            floatingGroups.push(newGroup);
        }

        function getRandomEmoji() {
            return popularEmojis[Math.floor(Math.random() * popularEmojis.length)];
        }

        function showNextComment() {
            if (currentCommentIndex >= comments.length) return;

            currentComment = comments[currentCommentIndex];
            document.querySelector('.username').textContent = currentComment.username;
            document.querySelector('.comment').innerHTML = currentComment.text;
        }

        let startTime = null;
        let timerInterval = null;
        let isTimerRunning = false;

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            if (startTime) {
                const elapsed = Date.now() - startTime;
                document.getElementById('timerDisplay').textContent = formatTime(elapsed);
            }
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            if (!isTimerRunning) {
                startTime = Date.now();
                isTimerRunning = true;
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        // åœæ­¢è®¡æ—¶
        function stopTimer() {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                // ä¿å­˜æ€»æ—¶é—´å’Œæ€»æ•²å‡»æ¬¡æ•°
                const totalTime = Math.floor((Date.now() - startTime) / 1000);
                localStorage.setItem('totalTime', totalTime.toString());
                localStorage.setItem('totalKeyPresses', totalKeyPresses.toString());
            }
        }

        // æ·»åŠ è¾“å…¥åˆæ³•æ€§æ£€æµ‹å‡½æ•°
        async function validateInput(text) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{
                            role: "system",
                            content: 'Determine if the input is a valid reply. Return only "valid" or "invalid". Criteria:\n- valid: any meaningful combination of words used in daily life, including simple interjections, emojis, or internet slang\n- invalid: obvious keyboard mashing (e.g., "asdfgh", "123456", ".,./;\'[]") or random character combinations'
                        }, {
                            role: "user",
                            content: text
                        }],
                        temperature: 0.3
                    })
                });

                const data = await response.json();
                return data.choices[0].message.content.trim().toLowerCase() === 'valid';
            } catch (error) {
                console.error('Error validating input:', error);
                return true;
            }
        }

        // ä¿®æ”¹é”®ç›˜è¾“å…¥äº‹ä»¶ç›‘å¬
        document.getElementById('textInput').addEventListener('keydown', function(e) {
            if (typeSound && typeSound.isLoaded()) {
                typeSound.play();
            }
            // å¤„ç†å›è½¦é”®
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (hasReplied) {
                    showPlatformTip("Click next to continue replying.");
                    return;
                }
                document.getElementById('sendButton').click();
                return;
            }

            startTimer(); // å¼€å§‹è®¡æ—¶
            
            // åˆ›å»ºæ•…éšœæ•ˆæœ
            if (glitchEffect) {
                glitchEffect.createGlitch();
            }
            
            const now = Date.now();
            
            // å¦‚æœè¶…è¿‡2ç§’æ²¡æœ‰è¾“å…¥ï¼Œé‡ç½®å½“å‰ä¼šè¯
            if (!typingStartTime || (now - lastTypingTime) > TYPING_INTERVAL) {
                typingStartTime = now;
                currentKeyPresses = 0;
            }
            
            lastTypingTime = now;
            currentKeyPresses++;
            totalKeyPresses++;
            
            // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
            if (typingTimeout) {
                clearTimeout(typingTimeout);
            }
            
            // è®¡ç®—å½“å‰è¾“å…¥é€Ÿåº¦
            const timeElapsed = (now - typingStartTime) / 1000;
            if (timeElapsed > 0) {
                const pressesPerSecond = (currentKeyPresses / timeElapsed).toFixed(1);
                document.getElementById('replySpeed').textContent = pressesPerSecond;
                updateLaborStats(Number(pressesPerSecond));
            }
            
            // è®¾ç½®2ç§’åé‡ç½®å½“å‰ä¼šè¯
            typingTimeout = setTimeout(() => {
                typingStartTime = null;
                currentKeyPresses = 0;
                document.getElementById('replySpeed').textContent = '0.0';
                updateLaborStats(0);
            }, TYPING_INTERVAL);
        });

        // å‘é€æŒ‰é’®äº‹ä»¶
        document.getElementById('sendButton').addEventListener('click', async () => {
            const text = document.getElementById('textInput').value.trim();
            if (text) {
                // è§¦å‘æ•…éšœæ•ˆæœ
                if (glitchEffect) {
                    glitchEffect.createGlitch();
                }

                if (hasReplied) {
                    showPlatformTip("Click next to continue replying.");
                    return;
                }

                // å…ˆéªŒè¯è¾“å…¥
                const isValid = await validateInput(text);
                if (!isValid) {
                    showPlatformTip("Please enter a meaningful reply.");
                    return;
                }

                // åˆ†ææƒ…ç»ªä½†ä¸æ˜¾ç¤º
                const emotion = await analyzeEmotion(text);
                updateEmotionStats(emotion);

                // æ˜¾ç¤ºéšæœºå¹³å°æç¤º
                const randomTip = platformTips[Math.floor(Math.random() * platformTips.length)];
                showPlatformTip(randomTip);

                hasReplied = true;
                createFloatingText(text);

                // æ¸…ç©ºè¯„è®ºåŒº
                document.querySelector('.username').textContent = '';
                document.querySelector('.comment').textContent = '';

                // æ£€æŸ¥æ˜¯å¦æ˜¯æœ€åä¸€æ¡è¯„è®º
                if (currentCommentIndex === totalComments - 1) {
                    // å¦‚æœæ˜¯æœ€åä¸€æ¡è¯„è®ºï¼Œéšè—Next commentæŒ‰é’®ï¼Œå»¶è¿Ÿåæ˜¾ç¤ºä¸­å¤®ContinueæŒ‰é’®
                    document.querySelector('.next-comment-btn').style.display = 'none';
                    setTimeout(() => {
                        document.getElementById('centerContinueButton').style.display = 'block';
                    }, 2000); // 2ç§’åæ˜¾ç¤ºContinueæŒ‰é’®
                } else {
                    // æ˜¾ç¤ºä¸‹ä¸€æ¡è¯„è®ºæŒ‰é’®
                    document.querySelector('.next-comment-btn').classList.add('show');
                }

                setTimeout(() => {
                    const floatingComment = new CommentFloater(currentComment.username, currentComment.text);
                    floatingComments.push(floatingComment);
                    nextStopY += 80;
                }, 1500);

                document.getElementById('textInput').value = '';
                messageCount++;
                
                // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                document.getElementById('totalInputCount').textContent = totalKeyPresses;
                document.getElementById('averageKeyCount').textContent = 
                    messageCount > 0 ? Math.round(totalKeyPresses / messageCount) : 0;
                if (speedHistory.length > 0) {
                    const avgSpeed = (speedHistory.reduce((a, b) => a + b, 0) / speedHistory.length).toFixed(1);
                    document.getElementById('averageSpeed').textContent = avgSpeed;
                }
                
                // é‡ç½®å½“å‰ä¼šè¯çš„ç»Ÿè®¡
                currentKeyPresses = 0;
                typingStartTime = null;
                lastTypingTime = null;
                document.getElementById('replySpeed').textContent = '0.0';
                document.getElementById('speedBar').style.width = '0%';
            }
        });

        // ä¸‹ä¸€æ¡è¯„è®ºæŒ‰é’®äº‹ä»¶
        document.querySelector('.next-comment-btn').addEventListener('click', () => {
            // è§¦å‘æ•…éšœæ•ˆæœ
            if (glitchEffect) {
                glitchEffect.createGlitch();
            }

            if (!hasReplied) {
                showPlatformTip("Please reply to the current comment first.");
                return;
            }

            if (currentCommentIndex < totalComments - 1) {
                currentCommentIndex++;
                hasReplied = false;
                showNextComment();
                updateRemainingCount();
                // éšè—ä¸‹ä¸€æ¡è¯„è®ºæŒ‰é’®
                document.querySelector('.next-comment-btn').classList.remove('show');
            } else {
                // æ‰€æœ‰è¯„è®ºå·²å›å¤ï¼Œæ˜¾ç¤ºä¸­å¤®ContinueæŒ‰é’®
                document.querySelector('.next-comment-btn').style.display = 'none';
                document.getElementById('centerContinueButton').style.display = 'block';
            }
        });

        // ä¸­å¤®ContinueæŒ‰é’®äº‹ä»¶
        document.getElementById('centerContinueButton').addEventListener('click', () => {
            stopTimer(); // åœæ­¢è®¡æ—¶
            // ç›´æ¥è·³è½¬åˆ°scene2_reflection.htmlï¼Œä¸æ˜¾ç¤ºåŠ è½½é®ç½©å±‚
            window.location.href = 'scene2_reflection.html';
        });

        function updateRemainingCount() {
            const remaining = totalComments - currentCommentIndex - 1;
            document.getElementById('remainingComments').textContent = remaining;

            // æ›´æ–°æŒ‰é’®æ–‡å­—
            const button = document.querySelector('.next-comment-btn');
            if (remaining === 0) {
                button.innerHTML = '<i class="ri-arrow-right-line"></i>Next comment';
            } else {
                button.innerHTML = '<i class="ri-arrow-right-line"></i>Next comment Â· <span id="remainingComments">' + remaining + '</span> left';
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight - 210);
        }

        let typeSound;

        function preload() {
            typeSound = loadSound('./assets/type.mp3');
        }

        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight - 210);
            canvas.position(0, 50);
            canvas.style('z-index', '999');
            textFont('monospace');
            background(0, 0, 0, 0);
            
            // åˆå§‹åŒ–æ•…éšœæ•ˆæœ
            glitchEffect = new GlitchEffect();
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
            document.body.addEventListener('click', function(e) {
                // æ’é™¤è¾“å…¥æ¡†å’ŒæŒ‰é’®çš„ç‚¹å‡»
                if (!e.target.closest('#inputArea') && !e.target.closest('.next-comment-btn')) {
                    glitchEffect.createGlitch();
                }
            });
        }

        // æ·»åŠ DOMContentLoadedäº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            showNextComment();
            updateRemainingCount();
            
            // è°ƒæ•´ä»»åŠ¡ä¿¡æ¯é«˜åº¦ä¸åŠ³åŠ¨ç»Ÿè®¡å®¹å™¨ä¸€è‡´
            const laborStats = document.getElementById('laborStats');
            const taskInfo = document.getElementById('taskInfo');
            const emotionAnalysis = document.querySelector('.emotion-analysis');
            
            if (laborStats && taskInfo && emotionAnalysis) {
                // ä½¿ç”¨ getComputedStyle è·å–å®é™…æ ·å¼
                const laborStyle = window.getComputedStyle(laborStats);
                const taskStyle = window.getComputedStyle(taskInfo);
                
                // è®¾ç½®ä»»åŠ¡ä¿¡æ¯å®¹å™¨çš„å†…å®¹é«˜åº¦
                taskInfo.style.height = laborStats.offsetHeight + 'px';
                
                // ç¡®ä¿å…ƒç´ ä¸é‡å 
                adjustContainersLayout();
                
                // è°ƒæ•´ä»»åŠ¡ä¿¡æ¯å†…éƒ¨å®¹å™¨çš„æ ·å¼
                const taskTitle = taskInfo.querySelector('.task-title');
                if (taskTitle) {
                    taskTitle.style.marginBottom = '10px';
                }
                
                // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨å°ºå¯¸æ˜¾ç¤º
                /* 
                // æ˜¾ç¤ºå®¹å™¨å°ºå¯¸
                showContainerSize(laborStats, 'laborStats');
                showContainerSize(taskInfo, 'taskInfo');
                showContainerSize(emotionAnalysis, 'emotion-analysis');
                */
                
                // æ·»åŠ çª—å£å¤§å°å˜åŒ–çš„å¤„ç†
                window.addEventListener('resize', function() {
                    // é‡æ–°è°ƒæ•´ä»»åŠ¡ä¿¡æ¯å®¹å™¨é«˜åº¦
                    taskInfo.style.height = laborStats.offsetHeight + 'px';
                    
                    // ç¡®ä¿å…ƒç´ ä¸é‡å 
                    adjustContainersLayout();
                    
                    /* 
                    // æ›´æ–°å°ºå¯¸æ˜¾ç¤º
                    updateSizeDisplay(laborStats);
                    updateSizeDisplay(taskInfo);
                    updateSizeDisplay(emotionAnalysis);
                    */
                });
            }
        });

        // è°ƒæ•´å®¹å™¨å¸ƒå±€ç¡®ä¿ä¸é‡å 
        function adjustContainersLayout() {
            const laborStats = document.getElementById('laborStats');
            const taskInfo = document.getElementById('taskInfo');
            const emotionAnalysis = document.querySelector('.emotion-analysis');
            
            if (!laborStats || !taskInfo || !emotionAnalysis) return;
            
            // è·å–å®é™…å®½åº¦å’Œä½ç½®
            const laborRect = laborStats.getBoundingClientRect();
            const taskRect = taskInfo.getBoundingClientRect();
            const windowWidth = window.innerWidth;
            
            // ç¡®ä¿laborStatsä¿æŒåœ¨æœ€å³ä¾§
            laborStats.style.right = '2%';
            
            // æ ¹æ®laborStatsçš„å®é™…ä½ç½®å’Œå®½åº¦åŠ¨æ€è®¾ç½®taskInfoçš„ä½ç½®
            const laborRight = laborRect.right;
            const laborLeft = laborRect.left;
            const laborWidth = laborRect.width;
            
            // è®¡ç®—taskInfoåº”è¯¥åœ¨çš„ä½ç½®ï¼Œç¡®ä¿ä¸¤è€…ä¹‹é—´æœ‰10pxé—´è·
            const taskRight = laborLeft - 10;
            const rightPercentage = ((windowWidth - taskRight) / windowWidth) * 100;
            
            // è®¾ç½®taskInfoçš„rightä½ç½®
            taskInfo.style.right = `${rightPercentage}%`;
            
            // è·å–è°ƒæ•´åçš„ä½ç½®å’Œå°ºå¯¸
            const updatedTaskRect = taskInfo.getBoundingClientRect();
            const updatedLaborRect = laborStats.getBoundingClientRect();
            
            // ç²¾ç¡®è®¡ç®—ä¸¤ä¸ªå®¹å™¨çš„æ€»å®½åº¦åŠ ä¸Šé—´è·
            const totalWidth = laborWidth + updatedTaskRect.width + (laborLeft - updatedTaskRect.right);
            
            // æ›´æ–°æƒ…ç»ªåˆ†æå®¹å™¨å®½åº¦
            emotionAnalysis.style.right = '2%';
            
            // ç¡®ä¿å®½åº¦åœ¨æœ€å°å’Œæœ€å¤§å€¼ä¹‹é—´
            const minWidth = 380;
            const maxWidth = 900;
            
            if (totalWidth < minWidth) {
                emotionAnalysis.style.width = `${minWidth}px`;
            } else if (totalWidth > maxWidth) {
                emotionAnalysis.style.width = `${maxWidth}px`;
            } else {
                emotionAnalysis.style.width = `${totalWidth}px`;
            }
        }

        // åˆ›å»ºæ˜¾ç¤ºå®¹å™¨å°ºå¯¸çš„å‡½æ•°
        function showContainerSize(container, name) {
            if (!container) return;
            
            // è·å–å®¹å™¨çš„å®é™…å°ºå¯¸
            const rect = container.getBoundingClientRect();
            const width = Math.round(rect.width);
            const height = Math.round(rect.height);
            
            // åˆ›å»ºå°ºå¯¸æ˜¾ç¤ºå…ƒç´ 
            const sizeDisplay = document.createElement('div');
            sizeDisplay.className = 'size-display';
            sizeDisplay.textContent = `${width}Ã—${height}`;
            sizeDisplay.style.position = 'absolute';
            sizeDisplay.style.top = '2px';
            sizeDisplay.style.right = '2px';
            sizeDisplay.style.fontSize = '10px';
            sizeDisplay.style.background = 'rgba(0,0,0,0.5)';
            sizeDisplay.style.color = '#ffff00';
            sizeDisplay.style.padding = '2px 4px';
            sizeDisplay.style.borderRadius = '3px';
            sizeDisplay.style.zIndex = '1001';
            
            // ç¡®ä¿å®¹å™¨æ˜¯ç›¸å¯¹å®šä½ï¼Œä»¥ä¾¿ç»å¯¹å®šä½å°ºå¯¸æ˜¾ç¤º
            const originalPosition = window.getComputedStyle(container).position;
            if (originalPosition === 'static') {
                container.style.position = 'relative';
            }
            
            // æ·»åŠ å°ºå¯¸æ˜¾ç¤ºåˆ°å®¹å™¨
            container.appendChild(sizeDisplay);
            
            // å°†å°ºå¯¸ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°
            console.log(`${name} å°ºå¯¸: ${width}Ã—${height}px`);
        }

        // æ›´æ–°å°ºå¯¸æ˜¾ç¤º
        function updateSizeDisplay(container) {
            if (!container) return;
            
            // è·å–å®¹å™¨çš„å®é™…å°ºå¯¸
            const rect = container.getBoundingClientRect();
            const width = Math.round(rect.width);
            const height = Math.round(rect.height);
            
            // æŸ¥æ‰¾å¹¶æ›´æ–°å°ºå¯¸æ˜¾ç¤ºå…ƒç´ 
            let sizeDisplay = container.querySelector('.size-display');
            if (sizeDisplay) {
                sizeDisplay.textContent = `${width}Ã—${height}`;
            } else {
                // å¦‚æœæ²¡æœ‰åˆ™åˆ›å»º
                showContainerSize(container, container.id || 'container');
            }
        }

        function draw() {
            clear();
            background(0, 0, 0, 0); // ä¿æŒé€æ˜èƒŒæ™¯

            // æ›´æ–°å’Œæ˜¾ç¤ºæ•…éšœæ•ˆæœ
            glitchEffect.update();

            // ç»˜åˆ¶æ¼‚æµ®æ–‡å­—
            for (let group of floatingGroups) {
                for (let char of group) {
                    char.move();
                    char.display();
                }
            }

            // ç»˜åˆ¶æ¼‚æµ®çš„è¯„è®º
            for (let comment of floatingComments) {
                comment.move();
                comment.display();
            }
        }

        // ç¡®ä¿é¡µé¢åŠ è½½å’Œçª—å£å¤§å°å˜åŒ–æ—¶éƒ½ç«‹å³è°ƒæ•´å¸ƒå±€
        window.addEventListener('load', function() {
            setTimeout(adjustContainersLayout, 0);
            
            // ç§»é™¤æ‰€æœ‰å·²å­˜åœ¨çš„å°ºå¯¸æ˜¾ç¤º
            document.querySelectorAll('.size-display').forEach(display => {
                display.remove();
            });
        });

        window.addEventListener('resize', function() {
            adjustContainersLayout();
        });
    </script>
</body>

</html>